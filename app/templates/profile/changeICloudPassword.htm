<div id="change-iCloud-pass-content">
    <h1 class="text-center">{$title}</h1>
    <div class="row">
        <div class="col-lg-12">
            {insert "inc.flashMessages.htm"}
        </div>
    </div>
    <div class="row">
        <div class="col-lg-4 col-md-4 col-sm-6 col-lg-offset-4 col-md-offset-4 col-sm-offset-3">
            <div class="panel panel-default">
                <div class="panel-body">
                    <form id="form-iCloud-pass" method="post" autocomplete="off" role="form">
                        <div class="form-group">
                            <input class="form-control" value="{$iCloud->getAppleId()}" disabled>
                        </div>
                        <div class="form-group">
                            <input class="form-control" type="password" name="newPassword">
                        </div>
                        <button class="btn btn-primary" type="submit" disabled>{$di->getTranslator()->_('Update')}</button>
                        <img style="display: none" id="loading" class="pull-right" src="/static/img/loader.gif">
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>
<script type="text/javascript">
    
    var $form = $('#form-iCloud-pass');
    var $submitButton = $form.find('[type=submit]');
    var $password = $form.find('input[name=newPassword]');
    var $loading = $('#loading');
    $form.submit(function(){
        var $form = $(this);
        $submitButton = $form.find('input, button').prop('disabled', true);
        $loading.show();
        $.ajax({
            dataType: "json",
            type: "post",
            url: $form.attr('action'),
            data: { newPassword: $password.val() },
            success: function(jsonResponse){
                if(!jsonResponse.hasOwnProperty('status') || !jsonResponse.status || !jsonResponse.hasOwnProperty('data') || !jsonResponse.data.hasOwnProperty('location'))
                    window.location.reload();
                
                else window.location.replace(jsonResponse.data.location);
            },
            error: function(response){
                console.log(response);
                window.location.reload();
            }
        });
        return false;
        
    }).find('input[name=newPassword]').on("input",function() {
        if($(this).val().length >= 3)
            $submitButton.prop('disabled', false);
        else $submitButton.prop('disabled', true);
    });
    
</script> 